
@{
    ViewBag.Title = "ChiTietPhong";
    Layout = "~/Views/Shared/_LayoutHomes.cshtml";
}

<script src="~/Scripts/jquery-3.4.1.min.js"></script>

<div class="site-section">
    <div class="container" id="chiTietPhong">

    </div>
</div>

<script>
    var idRoom = sessionStorage.getItem('keyRoomEdit');
    var img = "";

    $.ajax({
        url: 'https://localhost:44370/api/v1/room/' + idRoom,
        method: 'GET',
        contentType: 'json',
        dataType: 'json',
        error: function (res) {

        },
        success: function (res) {
            let table = '';
            table += `
        <div class="row align-items-center">
                <div class="col-md-6 mb-5 mb-md-0">

                    <div class="img-border">
                        <a href="https://vimeo.com/28959265" class="popup-vimeo image-play">
                            <span class="icon-wrap">
                                <span class="icon icon-play"></span>
                            </span>
                            <img src="/Styles/images/`+ res.Anh + `" alt="Ảnh phòng 1" class="img-fluid imgDemo">
                        </a>
                    </div>
                    <img src="/Styles/images/`+ res.Anh + `" alt="Ảnh phòng 2"class="img-fluid imgDemo image-absolute">

                </div>
                <div class="col-md-5 ml-auto">
                    <div class="section-heading text-left">
                        <h2 class="mb-5">Thông tin</h2>
                    </div>
                    <table style="width:100%;">
                        <tr>
                            <th>Phòng:</th>
                            <td><input type="text" id="txtTenPhong" value="`+ res.TenPhong + `"  required /></td>
                        </tr>
                        <tr>
                            <th>Loại phòng:</th>
                            <td>
                                <select id="sel">
                                    <option value="1">Thường</option>
                                    <option value="2">VIP</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>Số giường:</th>
                            <td>`+ res.LoaiPhongs[0].SoGiuong + `</td>
                        </tr>
                        <tr>
                            <th>Giá phòng:</th>
                            <td>`+ res.LoaiPhongs[0].Gia + ` VNĐ</td>
                        </tr>

                        <tr>
                            <th>Ảnh phòng:</th>
                            <td><input type="file" id="file-upload" value="C:\\fakepath\\`+ res.Anh + `"  required /></td>
                        </tr>

                    </table>

                    <br>
                    <p class="mb-4">Khách sạn Hoàng Hôn luôn mang vẻ đẹp hiện đại xen lẫn nét cổ kính. Đặt khách sạn sớm nhất để hưởng trọn ưu đãi, hứa hẹn một kì nghỉ với những ...</p>
                    <p>
                        <a href="https://vimeo.com/28959265" class="btn btn-primary pill px-4  popup-vimeo text-uppercase btn btn-XemVideo">Xem Video <span class="icon-arrow-right small"></span></a>
                        <button onclick="editRoom()" class="btn btn-primary pill text-white px-4 btn-DatPhong" id="btn-SuaPhong">Sửa</button>
                    </p>

                </div>
            </div>
            `;

            document.getElementById('chiTietPhong').innerHTML = table;

            img = res.Anh;

            var options = document.getElementById('sel').children;
            for (var i = 0; i < options.length; ++i) {
                if (options[i].textContent == res.LoaiPhongs[0].TenLoai) {
                    options[i].selected = true;
                }
            }

            document.getElementById('file-upload').onchange = function () {
                var imageDemo = document.getElementsByClassName("imgDemo");
                var arr = this.value.split("\\");
                for (var i = 0; i < imageDemo.length; ++i) {
                    imageDemo[i].src = "/Styles/images/" + arr[arr.length - 1];
                    img = arr[arr.length - 1];
                }
            };
            
            
        },
        fail: function (response) { }

    });
    
    function editRoom() {
        var url = 'https://localhost:44370/api/v1/room/edit?idPhong=' + idRoom + '&Ten=' + $('#txtTenPhong').val() + '&idLoai=' + $('#sel :selected').val() + '&img=' + img;
        var headers = "Bearer " + localStorage.getItem("token");
        $.ajax({
            url: url,
            headers: {
                "Authorization": headers
            },
            type: 'PUT',
            error: function (err) {
                console.log('Error!', err)
            },
            success: function (data) {
                alert("Sửa thành công!!!");
                window.location = "https://localhost:44370/Admin/EdipRoom";
            }
        });
    }
  
</script>

